<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="YearlySummaryReport" pageWidth="595" pageHeight="842" leftMargin="20" rightMargin="20" whenNoDataType="NoPages">
    <parameter name="startDate" class="java.time.LocalDate"/>
    <parameter name="endDate" class="java.time.LocalDate"/>
    <parameter name="currencySymbol" class="java.lang.String">
        <defaultValueExpression><![CDATA["VND"]]></defaultValueExpression>
    </parameter>
    <field name="totalIncome" class="java.math.BigDecimal"/>
    <field name="totalExpenses" class="java.math.BigDecimal"/>
    <field name="yearlyDetails" class="java.util.List"/>
    <title>
        <band height="100">
            <rectangle>
                <reportElement x="0" y="0" width="555" height="100" backcolor="#2C3E50"/>
                <graphicElement>
                    <pen lineWidth="0"/>
                </graphicElement>
            </rectangle>
            <staticText>
                <reportElement x="0" y="0" width="555" height="100" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="24" isBold="true"/>
                </textElement>
                <text><![CDATA[YEARLY SUMMARY]]></text>
            </staticText>
        </band>
    </title>
    <detail>
        <band height="320">
            <staticText>
                <reportElement x="20" y="20" width="510" height="25" forecolor="#2C3E50"/>
                <textElement verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="15" isBold="true"/>
                </textElement>
                <text><![CDATA[Financial Overview]]></text>
            </staticText>

            <rectangle>
                <reportElement x="40" y="55" width="230" height="80" backcolor="#E8F5E8"/>
                <graphicElement>
                    <pen lineWidth="1" lineColor="#27AE60"/>
                </graphicElement>
            </rectangle>
            <textField>
                <reportElement x="55" y="70" width="200" height="20" forecolor="#27AE60"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="12" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["Total Income of " + $P{startDate}.format(java.time.format.DateTimeFormatter.ofPattern("yyyy"))]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="55" y="90" width="200" height="30" forecolor="#27AE60"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[
                $F{totalIncome} != null ?
                ($P{currencySymbol}.equals("USD")
                    ? new java.text.DecimalFormat("#,##0.00").format($F{totalIncome})
                    : new java.text.DecimalFormat("#,##0").format($F{totalIncome}))
                    + " " + $P{currencySymbol}
                : "0 " + $P{currencySymbol}
            ]]></textFieldExpression>
            </textField>

            <rectangle>
                <reportElement x="285" y="55" width="230" height="80" backcolor="#FDF2F2"/>
                <graphicElement>
                    <pen lineWidth="1" lineColor="#E74C3C"/>
                </graphicElement>
            </rectangle>
            <textField>
                <reportElement x="300" y="70" width="200" height="20" forecolor="#E74C3C"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="12" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["Total Expenses of " + $P{startDate}.format(java.time.format.DateTimeFormatter.ofPattern("yyyy"))]]></textFieldExpression>
            </textField>
            <textField isBlankWhenNull="true">
                <reportElement x="300" y="90" width="200" height="30" forecolor="#E74C3C"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[
                $F{totalExpenses} != null ?
                ($P{currencySymbol}.equals("USD")
                    ? new java.text.DecimalFormat("#,##0.00").format($F{totalExpenses})
                    : new java.text.DecimalFormat("#,##0").format($F{totalExpenses}))
                    + " " + $P{currencySymbol}
                : "0 " + $P{currencySymbol}
            ]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement x="20" y="150" width="510" height="25" forecolor="#2C3E50"/>
                <textElement verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="14" isBold="true"/>
                </textElement>
                <text><![CDATA[Yearly Breakdown]]></text>
            </staticText>

            <subreport>
                <reportElement x="20" y="180" width="510" height="120"/>
                <subreportParameter name="currencySymbol">
                    <subreportParameterExpression><![CDATA[$P{currencySymbol}]]></subreportParameterExpression>
                </subreportParameter>
                <dataSourceExpression><![CDATA[new net.sf.jasperreports.engine.data.JRBeanCollectionDataSource($F{yearlyDetails})]]></dataSourceExpression>
                <subreportExpression><![CDATA["reports/yearly-detail-subreport.jasper"]]></subreportExpression>
            </subreport>
        </band>
    </detail>

    <summary>
        <band height="80">
            <rectangle>
                <reportElement x="0" y="20" width="555" height="60" backcolor="#F8F9FA"/>
                <graphicElement>
                    <pen lineWidth="0"/>
                </graphicElement>
            </rectangle>
            <textField isBlankWhenNull="true">
                <reportElement x="20" y="40" width="350" height="20"/>
                <textElement verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="11" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[
                    $F{totalIncome} != null && $F{totalExpenses} != null &&
                    $F{totalIncome}.compareTo($F{totalExpenses}) >= 0
                    ? "Positive Cash Flow"
                    : (
                        $F{totalIncome} != null && $F{totalExpenses} != null
                        ? "Negative Cash Flow"
                        : "Financial Analysis"
                    )
                ]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement x="290" y="50" width="250" height="20" forecolor="#95A5A6"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="9" isItalic="true"/>
                </textElement>
                <text><![CDATA[Generated by Money Management System]]></text>
            </staticText>
            <textField pattern="dd/MM/yyyy HH:mm">
                <reportElement x="380" y="30" width="160" height="20" forecolor="#95A5A6"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="Times New Roman" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[new java.util.Date()]]></textFieldExpression>
            </textField>
        </band>
    </summary>
</jasperReport>